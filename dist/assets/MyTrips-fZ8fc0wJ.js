import{c as R,r as m,u as ce,b as g,j as e,L as X,m as de,P as J,C as v,d as me,e as xe,X as pe,f as Q,T as ue,M as he,h as Z,i as ee,A as ye,p as I,k as ge}from"./index-BnGfZicH.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],b=R("arrow-up-down",fe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],k=R("chevron-up",we);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ne=R("download",je);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],be=R("external-link",ve);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ce=R("pen",ke),E=async(f,x=!1)=>{let l=f.trim();if(!l)return{waypoints:[],rawNames:[]};l.startsWith("http")||(!l.includes(".")&&!l.includes("/")&&l.length>=10?l=`https://maps.app.goo.gl/${l}`:l=`https://${l}`);try{const z=`${ye}/api/resolve?url=${encodeURIComponent(l)}${x?"&mode=browser":""}`,p=await fetch(z);if(!p.ok)return x?{waypoints:I(l),rawNames:[]}:E(l,!0);const c=await p.json(),u=I(c.resolvedUrl);return c.waypointNames&&Array.isArray(c.waypointNames)&&c.waypointNames.length>0?(u.forEach((C,d)=>{c.waypointNames[d]&&(C.name=ge(c.waypointNames[d]))}),{waypoints:u,rawNames:c.waypointNames}):!x&&!c.browserUsed&&u.some(d=>d.name.match(/^-?\d+\.\d+, -?\d+\.\d+$/)||d.name.startsWith("Waypoint "))?E(l,!0):{waypoints:u,rawNames:[]}}catch(z){return console.error("Resolution error:",z),x?{waypoints:I(l),rawNames:[]}:E(l,!0)}};function _e(){const[f,x]=m.useState([]),[l,z]=m.useState(!0),[p,c]=m.useState(null),[u,C]=m.useState(""),[d,$]=m.useState(""),[W,_]=m.useState(""),[O,S]=m.useState(""),[L,M]=m.useState(""),[V,T]=m.useState(""),[B,H]=m.useState(!1),[h,te]=m.useState("id"),[y,G]=m.useState("desc"),U=ce();m.useEffect(()=>{window.scrollTo(0,0);const t=g.getCurrentUser();if(!t){U("/");return}(async()=>{const a=await g.getTrips(t.id);x(a),z(!1),se(a,t.id)})()},[U]);const se=async(t,r)=>{var a;for(const s of t){const i=!s.year||!s.year.trim(),o=!s.location||!s.location.trim(),j=!s.route_summary||!s.route_summary.trim();if((i||o||j)&&((a=s.link)!=null&&a.trim()))try{const{waypoints:n,rawNames:A}=await E(s.link);let D=s.year||"";i&&(D=Z());let F=s.route_summary||"";j&&n.length>0&&(F=n.map(N=>N.name).join(" → "));let P=s.location||"";if(o){let N=n.length>0?n:A.join(", ");(!N||typeof N=="string"&&!N.trim())&&n.length>0&&(N=n[n.length-1].name);const Y=await ee(N);Y&&(P=Y)}(D!==s.year||P!==s.location||F!==s.route_summary)&&(await g.updateTrip(s.id,r,s.name,s.link,D,P,s.note||"",F)).success&&x(Y=>Y.map(q=>q.id===s.id?{...q,year:D,location:P,route_summary:F}:q))}catch(n){console.error(`Failed to auto-resolve trip ${s.id}`,n)}}},w=t=>{h===t?G(y==="asc"?"desc":"asc"):(te(t),G(t==="created_at"||t==="year"||t==="id"?"desc":"asc"))},ae=[...f].sort((t,r)=>{let a=t[h],s=r[h];if(a==null&&(a=""),s==null&&(s=""),typeof a=="number"&&typeof s=="number")return y==="asc"?a-s:s-a;const i=String(a).toLowerCase(),o=String(s).toLowerCase();return i===o?r.created_at-t.created_at:y==="asc"?i.localeCompare(o):o.localeCompare(i)}),K=()=>{var r;const t={id:-1,user_id:((r=g.getCurrentUser())==null?void 0:r.id)||0,name:"",link:"",year:"",location:"",note:"",route_summary:"",created_at:Date.now()};x([t,...f]),c(-1),C(""),$(""),_(""),S(""),M(""),T("")},ie=t=>{c(t.id),C(t.name),$(t.link),_(t.year||""),S(t.location||""),M(t.note||""),T(t.route_summary||"")},ne=()=>{p===-1&&x(t=>t.filter(r=>r.id!==-1)),c(null),C(""),$(""),_(""),S(""),M(""),T("")},re=async t=>{const r=g.getCurrentUser();if(!r)return;let a=V,s=W,i=O.trim();if((!a.trim()||!s.trim()||!i.trim())&&d.trim()){H(!0);try{const{waypoints:o,rawNames:j}=await E(d);if(!a.trim()&&o.length>0&&(a=o.map(n=>n.name).join(" → "),T(a)),s.trim()||(s=Z(),_(s)),!i.trim()){let n=o.length>0?o:j.join(", ");(!n||typeof n=="string"&&!n.trim())&&o.length>0&&(n=o[o.length-1].name);const A=await ee(n);A&&(i=A,S(A))}}catch(o){console.error("Failed to parse link for auto-fields",o)}finally{H(!1)}}if(t===-1){if(!u.trim()||!d.trim()){alert("Name and Link are required");return}const o=await g.saveTrip(r.id,u,d,s,i,L,a);o.success&&o.tripId?(x(j=>j.map(n=>n.id===-1?{...n,id:o.tripId,name:u,link:d,year:s,location:i,note:L,route_summary:a}:n)),c(null)):alert("Failed to save trip")}else(await g.updateTrip(t,r.id,u,d,s,i,L,a)).success?(x(j=>j.map(n=>n.id===t?{...n,name:u,link:d,year:s,location:i,note:L,route_summary:a}:n)),c(null)):alert("Failed to update trip")},oe=async t=>{const r=g.getCurrentUser();if(!r){alert("Please sign in to delete trips");return}if(confirm("Are you sure you want to delete this trip?"))try{await g.deleteTrip(t,r.id)?x(s=>s.filter(i=>i.id!==t)):alert("Failed to delete trip. Please try again.")}catch(a){console.error("Delete trip error:",a),alert("An error occurred while deleting the trip.")}},le=()=>{if(f.length===0)return;const r=[["Name","Route","Year","Location","Itinerary","Created","Notes"].join(","),...f.map(i=>[`"${i.name.replace(/"/g,'""')}"`,`"${i.link}"`,`"${(i.year||"").replace(/"/g,'""')}"`,`"${(i.location||"").replace(/"/g,'""')}"`,`"${(i.route_summary||"").replace(/"/g,'""')}"`,`"${new Date(i.created_at).toLocaleDateString()}"`,`"${(i.note||"").replace(/"/g,'""')}"`].join(","))].join(`
`),a=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const i=URL.createObjectURL(a);s.setAttribute("href",i),s.setAttribute("download","my_trips.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}};return l?e.jsxs("div",{className:"min-h-screen flex items-center justify-center text-white",children:[e.jsx(X,{className:"animate-spin mr-2"})," Loading trips..."]}):e.jsx("main",{className:"container min-h-screen pt-4 pb-24",children:e.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white tracking-tight",children:"My Trips"}),e.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Manage your saved journeys"})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:le,disabled:f.length===0,className:"flex items-center justify-center gap-0 sm:gap-2 bg-white/10 hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 sm:px-4 py-2.5 rounded-xl font-medium transition-all border border-white/10 active:scale-95",title:"Export CSV",children:[e.jsx(Ne,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]}),e.jsxs("button",{onClick:K,disabled:p!==null,className:"flex items-center justify-center gap-0 sm:gap-2 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-3 sm:px-4 py-2.5 rounded-xl font-medium transition-all shadow-lg shadow-indigo-500/20 active:scale-95",title:"Add Trip",children:[e.jsx(J,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Add Trip"})]})]})]}),f.length>0?e.jsx("div",{className:"glass-panel overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10 bg-white/5",children:[e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-10 sm:w-14 cursor-pointer hover:text-white transition-colors text-center",onClick:()=>w("id"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["No.",h==="id"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors",onClick:()=>w("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Name",h==="name"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-0 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors",onClick:()=>w("link"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Route",h==="link"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-16 sm:w-20 text-center cursor-pointer hover:text-white transition-colors",onClick:()=>w("year"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Time",h==="year"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-20 sm:w-24 cursor-pointer hover:text-white transition-colors",onClick:()=>w("location"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Location",h==="location"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors",onClick:()=>w("route_summary"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Itinerary",h==="route_summary"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-24 sm:w-32 text-center",children:"Actions"}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-16 sm:w-20 cursor-pointer hover:text-white transition-colors",onClick:()=>w("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Created",h==="created_at"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})}),e.jsx("th",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm font-semibold text-gray-300 w-24 sm:w-32 text-left cursor-pointer hover:text-white transition-colors",onClick:()=>w("note"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Notes",h==="note"?y==="asc"?e.jsx(k,{size:14}):e.jsx(v,{size:14}):e.jsx(b,{size:14,className:"opacity-30"})]})})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:ae.map((t,r)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm text-gray-500 text-center",children:r+1}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4",children:p===t.id?e.jsx("input",{type:"text",value:u,onChange:a=>C(a.target.value),placeholder:"Name",className:"w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500"}):e.jsx("div",{className:"font-medium text-white line-clamp-2 break-words",title:t.name,children:t.name})}),e.jsx("td",{className:"px-0 sm:px-2 py-3 sm:py-4",children:p===t.id?e.jsx("input",{type:"text",value:d,onChange:a=>$(a.target.value),placeholder:"https://maps.google.com/...",className:"w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm"}):e.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:text-indigo-300 flex items-center gap-1 text-sm max-w-[200px] truncate",children:[e.jsx(be,{size:14})," ",e.jsx("span",{className:"hidden md:inline",children:"Open "}),"Map"]})}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4 text-center",children:p===t.id?e.jsx("input",{type:"text",value:W,onChange:a=>_(a.target.value),placeholder:"Year",className:"w-14 bg-white/10 border border-white/20 rounded px-1 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm text-center"}):e.jsx("span",{className:"text-gray-300 text-sm",children:t.year})}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4",children:p===t.id?e.jsx("input",{type:"text",value:O,onChange:a=>S(a.target.value),placeholder:"Location",className:"w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm"}):e.jsx("div",{className:"text-gray-300 text-sm max-w-[100px] line-clamp-2 break-words",title:t.location||"",children:t.location||"-"})}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4",children:p===t.id?e.jsx("input",{type:"text",value:V,onChange:a=>T(a.target.value),placeholder:"Auto-generated if empty",className:"w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm"}):t.route_summary?e.jsxs("div",{className:"flex items-start gap-2 text-gray-400 text-sm w-full",title:t.route_summary,children:[e.jsx(me,{size:14,className:"mt-0.5 shrink-0"}),e.jsx("div",{className:"line-clamp-2 break-words leading-tight overflow-hidden",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:t.route_summary})]}):e.jsx("span",{className:"text-gray-600 text-sm italic",children:"No summary"})}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4",children:e.jsx("div",{className:"flex justify-start gap-2 transition-opacity",children:p===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(t.id),disabled:B,className:"p-2 hover:bg-emerald-500/20 rounded-lg text-emerald-400 hover:text-emerald-300 transition-colors disabled:opacity-50",title:"Save",children:B?e.jsx(X,{size:18,className:"animate-spin"}):e.jsx(xe,{size:18})}),e.jsx("button",{onClick:ne,className:"p-2 hover:bg-red-500/20 rounded-lg text-red-400 hover:text-red-300 transition-colors",title:"Cancel",children:e.jsx(pe,{size:18})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ie(t),className:"p-2 hover:bg-white/10 rounded-lg text-gray-400 hover:text-white transition-colors",title:"Edit Trip",children:e.jsx(Ce,{size:18})}),e.jsx("button",{onClick:()=>U(`/?url=${encodeURIComponent(t.link)}`),className:"p-2 hover:bg-white/10 rounded-lg text-indigo-400 hover:text-white transition-colors",title:"Analyze Route",children:e.jsx(Q,{size:18})}),e.jsx("button",{onClick:()=>oe(t.id),className:"p-2 hover:bg-red-500/20 rounded-lg text-gray-400 hover:text-red-400 transition-colors",title:"Delete Trip",children:e.jsx(ue,{size:18})})]})})}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-1 sm:px-2 py-3 sm:py-4 text-left",children:p===t.id?e.jsx("input",{type:"text",value:L,onChange:a=>M(a.target.value),className:"w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-white focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm"}):t.note?e.jsx("div",{className:"flex items-start justify-start text-gray-400 text-sm",children:e.jsx("span",{className:"line-clamp-1 text-left max-w-[120px] truncate",title:t.note,children:t.note})}):e.jsx("span",{className:"text-gray-600 text-sm italic",children:"No notes"})})]},t.id))})]})})}):e.jsxs("div",{className:"glass-panel p-16 text-center flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-6",children:e.jsx(he,{className:"text-gray-600",size:40})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No trips saved yet"}),e.jsx("p",{className:"text-gray-400 mb-8 max-w-md",children:"Start by analyzing a Google Maps route on the home page and save it to your collection, or add one manually."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>U("/"),className:"bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl font-bold transition-all flex items-center gap-2",children:[e.jsx(Q,{size:18}),"Go to Home"]}),e.jsxs("button",{onClick:K,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/20 flex items-center gap-2",children:[e.jsx(J,{size:18}),"Add Trip"]})]})]})]})})}export{_e as default};
